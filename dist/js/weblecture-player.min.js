/*! WebLecture Player - v1.0.0 - 2013-10-18
* http://
* Copyright (c) 2013 Nicola Tarocco; Licensed MyLicense */
var Helpers=function(){var months=new Array("January","February","March","April","May","June","July","August","September","October","November","December");return current_url=function(){return document.location.href.match(/(^[^#]*)/)[0]},param_by_name=function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))},format_date=function(date){var d=new Date(date),day=d.getDate();return day+=1===day||21===day||31===day?"st":2===day||22===day?"nd":3===day||23===day?"rd":"th",day+" "+months[d.getMonth()]+" "+d.getFullYear()},format_time=function(time){var t=time.split(":");return t[0]+":"+t[1]},format_duration_thumbs=function(duration){var fduration="";return duration?(0!==duration%60&&(fduration=parseInt(duration%60,10)+"s"+fduration),0!==duration%3600&&duration>60&&(fduration=parseInt(duration%3600/60,10)+"m "+fduration),duration>3600&&(fduration=parseInt(duration/3600,10)+"h "+fduration),fduration):0},format_sec2time=function(secs){var ftime="",s="00",m="00",h="00";return secs?(0!==secs%60&&(s=parseInt(secs%60,10),10>s&&(s="0"+s)),ftime=s+ftime,0!==secs%3600&&secs>60&&(m=parseInt(secs%3600/60,10),10>m&&(m="0"+m)),ftime=m+":"+ftime,secs>3600&&(h=parseInt(secs/3600,10),10>h&&(h="0"+h)),ftime=h+":"+ftime):"00:00:00"},format_time2sec=function(ftime){var t=ftime.split(":");return 3600*parseInt(t[0],10)+60*parseInt(t[1],10)+parseInt(t[2],10)},{current_url:current_url,param_by_name:param_by_name,format_date:format_date,format_time:format_time,format_duration_thumbs:format_duration_thumbs,format_sec2time:format_sec2time,format_time2sec:format_time2sec}}(),LectureParser=function(){return parse_xml=function(xml_data){config.debug&&console.log("Parsing lecture XML data");var $xml=$(xml_data);$xml.find("LECTURE")||console.error("lecture XML data not well formed!"),globals.lecture.fduration=$xml.find("FDURATION").text(),globals.lecture.duration=parseInt($xml.find("DURATION").text(),10),globals.lecture.title=$xml.find("LECTURE").attr("TITLE"),$xml.find("AUTHOR").each(function(){globals.lecture.speakers.push($(this).text().replace(",",""))}),globals.lecture.date=$xml.find("DATE").text(),globals.lecture.time=$xml.find("TIME").text(),globals.lecture.thumbs_width=parseInt($xml.find("SLIDE").first().attr("WIDTH"),10),globals.lecture.thumbs_height=parseInt($xml.find("SLIDE").first().attr("HEIGHT"),10),$xml.find("SLIDE").each(function(){globals.lecture.thumbs.push({begin:$(this).attr("FBEGIN"),beginsec:parseInt($(this).attr("BEGIN"),10),duration:parseInt($(this).attr("DURATION"),10),src:$(this).attr("SRC")})}),$xml.find("CHAPTER").each(function(){var speakers=[];speakers.push($(this).attr("SPEAKERS")),globals.lecture.chapters.push({begin:$(this).attr("FBEGIN"),beginsec:parseInt($(this).attr("BEGIN"),10),duration:parseInt($(this).attr("DURATION"),10),speakers:speakers,title:$(this).attr("TITLE")})})},parse_json=function(json_data){config.debug&&console.log("Parsing lecture XML data"),globals.lecture.title=json_data.lecture.title,globals.lecture.speakers=json_data.lecture.speakers,globals.lecture.date=json_data.lecture.date,globals.lecture.time=json_data.lecture.time,globals.lecture.fduration=json_data.lecture.fduration,globals.lecture.duration=json_data.lecture.duration,globals.lecture.thumbs_width=json_data.lecture.thumbs_w,globals.lecture.thumbs_height=json_data.lecture.thumbs_h,globals.lecture.thumbs=json_data.lecture.thumbs,globals.lecture.chapters=json_data.lecture.chapters},parse=function(data){return"XML"===config.lecture_file.type?parse_xml(data):"JSON"===config.lecture_file.type?parse_json(data):(console.error("No parser for lecture file format ",config.lecture_file[type]),void 0)},{parse:parse}}(),Resize=function(){var camera_vp_size=46,slides_vp_size=52;return handler=function(container_width,container_height){if(globals.camera_vp_ready&&globals.slides_vp_ready){container_width-=40,container_height-=40;var camera={w:0,h:0},slides={w:0,h:0};globals.camera_vp_visible&&globals.slides_vp_visible?(camera=calculate_new_dims(container_width,container_height,globals.camera_vp_ar,camera_vp_size,"camera"),slides=calculate_new_dims(container_width,container_height,globals.slides_vp_ar,slides_vp_size,"slides"),$(globals.camera_vp_container).css("float","left").css("position","relative").css("top","").css("left",""),$(globals.slides_vp_container).css("float","right").css("position","relative").css("top","").css("left",""),globals.jw_camera_vp.resize(camera.w,camera.h),globals.jw_slides_vp.resize(slides.w,slides.h)):globals.camera_vp_visible?(globals.jw_slides_vp.resize(1,1),$(globals.slides_vp_container).css("position","absolute").css("top",0).css("left",0),camera=calculate_new_dims(container_width,container_height,globals.camera_vp_ar,90,"camera"),$(globals.camera_vp_container).css("position","relative").css("top","").css("left",""),globals.jw_camera_vp.resize(camera.w,camera.h),$(globals.camera_vp_container).css("float","none"),$("#camera_vp_wrapper").css("margin","0 auto")):globals.slides_vp_visible&&(globals.jw_camera_vp.resize(1,1),$(globals.camera_vp_container).css("position","absolute").css("top",0).css("left",0),slides=calculate_new_dims(container_width,container_height,globals.slides_vp_ar,90,"slides"),$(globals.slides_vp_container).css("position","relative").css("top","").css("left",""),globals.jw_slides_vp.resize(slides.w,slides.h),$(globals.slides_vp_container).css("float","none"),$("#slides_vp_wrapper").css("margin","0 auto")),$("#videoplayers").css("width",camera.w+slides.w+10)}},calculate_new_dims=function(W,H,aspectRatio,percentage){var object={w:0,h:0},videoPlayerW=W*percentage/100,videoPlayerH=videoPlayerW/aspectRatio;return videoPlayerH>=H-globals.crop_adjustment&&(videoPlayerH=H-globals.crop_adjustment,videoPlayerW=videoPlayerH*aspectRatio),object.w=Math.max(Math.floor(videoPlayerW),300),object.h=Math.max(Math.floor(videoPlayerH),200),object},{handler:handler}}(),Videoplayers_KeepInSync=function(){var interval_keep_sync=100,max_delay=1e3,_controller={},_jw_camera_vp=null,_jw_slides_vp=null,_jw_videoplayers=[],_videoplayers_autostart=!1,_videoplayers_ready=0,_clicked_for_playing=!1,_paused_for_buffering=!1,_timecodes=[],_current_times=[];return _controller.parse_timecode=function(date,timecode){var ds=date.split("-"),ts=timecode.split(":"),tz=ts[2].split("."),month=parseInt(ds[1],10)-1;return new Date(ds[2],month,ds[0],ts[0],ts[1],tz[0],tz[1]).valueOf()},_controller.lowest_level=function(player){for(var levels=player.getPlaylistItem().levels,lowest=0,i=1;i<levels.length;i++)levels[i].bitrate<levels[lowest].bitrate&&(lowest=i);return levels[lowest]},_controller.change_videoplayers_bandwidth=function(total_bw){if(total_bw=parseInt(total_bw,10),!isNaN(total_bw)&&0!==total_bw){for(var all_normal=!0,i=0;i<_jw_videoplayers.length;i++)if(_jw_videoplayers[i].getFullscreen()&&(all_normal=!1,50===_jw_videoplayers[i].getBandwidthPercentage())){var lowest=_controller.lowest_level(_jw_videoplayers[1-i]),lowest_percent=Math.round(100*lowest.bitrate/total_bw);5>lowest_percent&&(lowest_percent=5),_jw_videoplayers[1-i].setBandwidthPercentage(lowest_percent),_jw_videoplayers[i].setBandwidthPercentage(100-lowest_percent)}all_normal&&50!=_jw_videoplayers[0].getBandwidthPercentage()&&(_jw_videoplayers[0].setBandwidthPercentage(50),_jw_videoplayers[1].setBandwidthPercentage(50))}},_controller.sync=function(){if("IDLE"!==_jw_videoplayers[0].getState()||"IDLE"!==_jw_videoplayers[1].getState())if("PLAYING"===_jw_videoplayers[0].getState()&&"PLAYING"===_jw_videoplayers[1].getState()){if("undefined"!=typeof _timecodes[_jw_videoplayers[0].id]&&null!==_timecodes[_jw_videoplayers[0].id]&&"undefined"!=typeof _timecodes[_jw_videoplayers[1].id]&&null!==_timecodes[_jw_videoplayers[1].id]){var timenow_diff=_current_times[_jw_videoplayers[0].id]-_current_times[_jw_videoplayers[1].id],timecode_diff=_timecodes[_jw_videoplayers[0].id]-_timecodes[_jw_videoplayers[1].id],delay=timecode_diff-timenow_diff;if(Math.abs(delay)>max_delay)if(delay>0){if(10===_jw_videoplayers[0].getBufferTime())return;var new_buffer_time=Math.round((1e3*_jw_videoplayers[0].getBufferTime()+delay)/1e3);new_buffer_time>10&&(new_buffer_time=10),_jw_videoplayers[0].setBufferTime(new_buffer_time)}else{if(10===_jw_videoplayers[1].getBufferTime())return;var new_buffer_time=Math.round((1e3*_jw_videoplayers[1].getBufferTime()+delay)/1e3);0>new_buffer_time&&(new_buffer_time=0),_jw_videoplayers[1].setBufferTime(new_buffer_time)}}}else for(var i=0;i<_jw_videoplayers.length;i++){if("IDLE"===_jw_videoplayers[i].getState()&&"PLAYING"===_jw_videoplayers[1-i].getState())return _jw_videoplayers[i].pause(!1),void 0;if("PLAYING"===_jw_videoplayers[i].getState()&&"BUFFERING"===_jw_videoplayers[1-i].getState())return _jw_videoplayers[i].pause(!0),_jw_videoplayers[i].waitingFor(),_paused_for_buffering=!0,void 0;if("PAUSED"===_jw_videoplayers[i].getState()&&"PLAYING"===_jw_videoplayers[1-i].getState()&&(_paused_for_buffering||_clicked_for_playing))return _jw_videoplayers[i].pause(!1),_paused_for_buffering=!1,_clicked_for_playing=!1,void 0;if("PLAYING"===_jw_videoplayers[i].getState()&&"PAUSED"===_jw_videoplayers[1-i].getState()&&!_paused_for_buffering&&!_clicked_for_playing)return _jw_videoplayers[i].pause(!0),void 0}},_controller.play=function(state){for(var i=0;i<_jw_videoplayers.length;i++)("PAUSED"!==_jw_videoplayers[i].getState()||state)&&("PLAYING"!==_jw_videoplayers[i].getState()&&"BUFFERING"!==_jw_videoplayers[i].getState()||!state)&&_jw_videoplayers[i].play(state)},_controller.stop=function(){for(var i=0;i<_jw_videoplayers.length;i++)_jw_videoplayers[i].stop()},_controller.onReady=function(){_videoplayers_ready+=1,_videoplayers_ready===_jw_videoplayers.length&&_videoplayers_autostart&&(_controller.play(!0),setInterval(_controller.sync,interval_keep_sync))},_controller.onFullscreen=function(){_controller.change_videoplayers_bandwidth(this.getBandwidthCalculated())},_controller.onBeforePlay=function(){_clicked_for_playing=!0},_controller.onMeta=function(event){var metadata=event.metadata;metadata.type&&("timecode"===metadata.type&&(console.log(event),_current_times[this.id]=Date.now(),_timecodes[this.id]=_controller.parse_timecode(metadata.sd,metadata.st)),"bandwidth"===metadata.type&&_controller.change_videoplayers_bandwidth(metadata.bandwidthcalculated))},init=function(jw_camera_vp,jw_slides_vp,autostart){_jw_camera_vp=jw_camera_vp,_jw_slides_vp=jw_slides_vp,_videoplayers_autostart=autostart,_jw_videoplayers.push(_jw_camera_vp),_jw_videoplayers.push(_jw_slides_vp),_jw_camera_vp.setBandwidthPercentage(50).onMeta(_controller.onMeta).onFullscreen(_controller.onFullscreen).onBeforePlay(_controller.onBeforePlay).setVolume(100).setMute(!1),_jw_slides_vp.setBandwidthPercentage(50).onMeta(_controller.onMeta).onFullscreen(_controller.onFullscreen).onBeforePlay(_controller.onBeforePlay).setMute(!0);for(var i=0;i<_jw_videoplayers.length;i++)_jw_videoplayers[i].isReady()?_controller.onReady():_jw_videoplayers[i].onReady(_controller.onReady)},{init:init}}(),globals={jw_videoplayers:[],jw_camera_vp:null,jw_slides_vp:null,camera_vp_ready:!1,slides_vp_ready:!1,camera_vp_container:document.getElementById("camera_vp_container"),slides_vp_container:document.getElementById("slides_vp_container"),camera_vp_visible:!0,slides_vp_visible:!0,player_mode:"html5",crop_adjustment:0,lecture:{fduration:"",duration:0,title:"",speakers:[],date:"",time:"",thumbs_width:0,thumbs_height:0,thumbs:[],chapters:[]}},Player=function(){var p={thumbs_small:{c:.8},thumbs_hover:{c:.9},thumbs_current:{c:1},thumbs_effect_delay:100,thumbs_padding_bottom:5,current_thumb:0,current_chapter:0,previous_seek_time:0,controlbar_btns_width:0,$scrollbar:null,current_centered:0,cursor_vol_btn:!1,cursor_vol_slider:!1,first_onmute_event:!0};return init_topbar=function(){config.debug&&console.log("Init topbar"),$("#title").html(globals.lecture.title),$("#speakers").html(globals.lecture.speakers.join(", ")),$("#when").html(Helpers.format_date(globals.lecture.date)+" at "+Helpers.format_time(globals.lecture.time)),$("#previous_slide").click(function(){btn_prev_thumb_onClick()}),$("#previous_slide").tooltip({placement:"bottom",container:"body"}),$("#next_slide").click(function(){btn_next_thumb_onClick()}),$("#next_slide").tooltip({placement:"bottom",container:"body"}),$("#current_slide").html("1"),$("#total_slides").html(globals.lecture.thumbs.length),globals.lecture.chapters.length>0?($("#chaptersbar").show(),$(globals.lecture.chapters).each(function(i){$("<li>").attr("id","chapter_"+i).append($("<a>").attr("href","#").html(i+1+" - "+this.title+" ["+this.speakers.join(",")+"]").click(function(){btn_chapter_onClick(i)})).appendTo("#chapters")}),$("#chapter_0").addClass("active")):$("#chaptersbar").remove(),$("#toggles input:radio").change(function(){toggle_videos($(this).val())}),$("#camera_only").parent().tooltip({placement:"bottom",container:"body",title:"Show only camera videoplayer"}),$("#slides_only").parent().tooltip({placement:"bottom",container:"body",title:"Show only slides videoplayer"}),$("#both_videos").parent().tooltip({placement:"bottom",container:"body",title:"Show both camera and slides videoplayers"}),$("#toggle_thumbs").click(function(){btn_toggle_thumbs_onClick()}),$("#toggle_thumbs").tooltip({placement:"bottom",container:"body",title:"Hide thumbnails"}),$("#btn_link").tooltip({placement:"bottom",container:"body"}),$("#btn_help").tooltip({placement:"bottom",container:"body"}),$("#get-link").on("show.bs.modal",function(){var t=p.previous_seek_time>0?Helpers.format_sec2time(p.previous_seek_time):"00:00:00",s=p.current_thumb+1<globals.lecture.thumbs.length?p.current_thumb+1:globals.lecture.thumbs.length;$("#link1").val(Helpers.current_url()),$("#link2").val(Helpers.current_url()+"&ftime="+t),$("#link3").val(Helpers.current_url()+"&slide="+s)})},init_videoplayers=function(){config.debug&&console.log("Init videoplayers"),globals.jw_camera_vp.onTime(onTime).onSeek(onTime).onPlay(function(){$("#btn_play").data("current","play"),$("#btn_play span").removeClass("fa-icon-play").addClass("fa-icon-pause"),$("#btn_play").tooltip("hide").attr("data-original-title","Click to pause").tooltip("fixTitle")}).onPause(function(){$("#btn_play").data("current","pause"),$("#btn_play span").removeClass("fa-icon-pause").addClass("fa-icon-play"),$("#btn_play").tooltip("hide").attr("data-original-title","Click to play").tooltip("fixTitle")}).onMute(function(e){e.mute===!0?($("#btn_volume").data("current","muted"),$("#btn_volume span").removeClass("fa-icon-volume-up").addClass("fa-icon-volume-off"),$("#btn_volume").tooltip("hide").attr("data-original-title","Click to unmute").tooltip("fixTitle"),$("#volume-slider").hide()):($("#btn_volume").data("current","unmuted"),$("#btn_volume span").removeClass("fa-icon-volume-off").addClass("fa-icon-volume-up"),$("#btn_volume").tooltip("hide").attr("data-original-title","Click to mute").tooltip("fixTitle"),p.first_onmute_event&&volume_slider_show()),p.first_onmute_event&&(p.first_onmute_event=!1)}).onBufferChange(function(){}).onComplete(function(){globals.jw_camera_vp.stop(),globals.jw_slides_vp.stop()})},init_thumbnails=function(){config.debug&&console.log("Init thumbails"),p.thumbs_current.w=Math.round(globals.lecture.thumbs_width*p.thumbs_current.c),p.thumbs_current.h=Math.round(globals.lecture.thumbs_height*p.thumbs_current.c),p.thumbs_small.w=Math.round(globals.lecture.thumbs_width*p.thumbs_small.c),p.thumbs_small.h=Math.round(globals.lecture.thumbs_height*p.thumbs_small.c),p.thumbs_hover.w=Math.round(globals.lecture.thumbs_width*p.thumbs_hover.c),p.thumbs_hover.h=Math.round(globals.lecture.thumbs_height*p.thumbs_hover.c),$("#thumbnails_container").height(p.thumbs_current.h+p.thumbs_padding_bottom);var thumbs_width=Math.round(p.thumbs_current.w+p.thumbs_hover.w+(globals.lecture.thumbs.length-2)*p.thumbs_small.w+10*globals.lecture.thumbs.length+50);$("#thumbnails").width(thumbs_width),$("#thumbnails").height(p.thumbs_current.h+p.thumbs_padding_bottom),$(globals.lecture.thumbs).each(function(i){config.debug&&console.log("Draw thumbail #",i);var size=0===i?{w:p.thumbs_current.w,h:p.thumbs_current.h,top:0,cl:"current"}:{w:p.thumbs_small.w,h:p.thumbs_small.h,top:p.thumbs_current.h-p.thumbs_small.h,cl:""},img='<img style="width: '+size.w+"px; height: "+size.h+"px; top: "+size.top+'px;" src="'+config.full_url+"/"+this.src+'" />',lbl='<span class="label label-default thumb_details" style="top: '+size.top+'px;">'+(i+1)+" | "+Helpers.format_duration_thumbs(globals.lecture.thumbs[i].duration)+"</span>",grayed='<div class="thumb_grayed" style="width: 0; height: '+size.h+"px; top: "+size.top+'px;"></div>',div='<div id="thumb_'+i+'" data-id="'+i+'" class="thumb '+size.cl+'" style="height: '+p.thumbs_current.h+'px;"></div>';$("#thumbnails").append($(div).append(img,lbl,grayed))}),$(".thumb").hover(function(){$(this).hasClass("current")||($(this).children("img").animate({width:p.thumbs_hover.w,height:p.thumbs_hover.h,top:p.thumbs_hover.h-p.thumbs_small.h},p.thumbs_effect_delay),$(this).children(".thumb_grayed").animate({height:p.thumbs_hover.h,top:p.thumbs_hover.h-p.thumbs_small.h},p.thumbs_effect_delay),$(this).children(".thumb_details").animate({top:p.thumbs_hover.h-p.thumbs_small.h},p.thumbs_effect_delay))},function(){$(this).hasClass("current")||($(this).children("img").animate({width:p.thumbs_small.w,height:p.thumbs_small.h,top:p.thumbs_current.h-p.thumbs_small.h},p.thumbs_effect_delay),$(this).children(".thumb_grayed").animate({height:p.thumbs_small.h,top:p.thumbs_current.h-p.thumbs_small.h},p.thumbs_effect_delay),$(this).children(".thumb_details").animate({top:p.thumbs_current.h-p.thumbs_small.h},p.thumbs_effect_delay))}).click(function(){btn_thumb_onClick($(this).data("id"))}),p.$scrollbar=$("#thumbs_scrollbar"),p.$scrollbar.tinyscrollbar({axis:"x",sizethumb:"100"}),p.current_centered=Math.round($("#scrollbar").width()/2-p.thumbs_current.w/2)},init_controlbar=function(){config.debug&&console.log("Init controlbar"),$("#btn_play").click(function(){play_controller("play"!==$("#btn_play").data("current"))}),$("#btn_play").tooltip({container:"body"}),$(".vslider").slider({max:100,orientation:"vertical",value:20,selection:"after"}).on("slide",function(e){$("#lbl_volume").html(100-e.value),globals.jw_camera_vp.setVolume(100-e.value)}),$("#volume-slider").hover(function(){p.cursor_vol_slider=!0},function(){p.cursor_vol_slider=!1,volume_slider_hide()}),$("#btn_volume").data("current","unmuted"),$("#btn_volume").click(function(){globals.jw_camera_vp.setMute("unmuted"===$("#btn_volume").data("current"))}).hover(function(){p.cursor_vol_btn=!0,volume_slider_show()},function(){p.cursor_vol_btn=!1,volume_slider_hide()}),$("#btn_volume").tooltip({placement:"left",container:"body"}),$("#lbl_current").html("00:00:00"),$("#lbl_duration").html(Helpers.format_sec2time(globals.lecture.duration)),p.controlbar_btns_width=0,$("#controlbar .controls").each(function(){p.controlbar_btns_width+=$(this).width()}),$("#progressbar_container").width($("#controlbar").width()-p.controlbar_btns_width),$("#progressbar").click(function(e){var seconds=Math.round((e.clientX-$(this).offset().left)*globals.lecture.duration/$("#progressbar").width());seconds>=0<=globals.lecture.duration&&(config.debug&&console.log("Click on progress bar. Seeking to:",seconds),_seek_videoplayers(seconds))}),$("#progressbar").tooltip({container:"body",animation:"false",title:"00:00:01",trigger:"manual"}),$("#progressbar").mousemove(function(e){var seconds=Math.round((e.clientX-$(this).offset().left)*globals.lecture.duration/$("#progressbar").width()),fsecs=Helpers.format_sec2time(seconds);$(".tooltip")&&($(".tooltip").css("left",e.pageX-Math.round($(".tooltip").width()/2)+"px"),$(".tooltip .tooltip-inner").html(fsecs))}).hover(function(){$("#progressbar").tooltip("show")},function(){$(this).tooltip("hide")}),$("body").css("padding-bottom",$("#thumbs_scrollbar").height()+$("#controlbar").height()+10)},init_tour=function(){var tour=new Tour({template:"<div class='popover tour'><div class='arrow'></div><h3 class='popover-title'></h3><div class='popover-content'></div><nav class='popover-navigation'><div class='btn-group'><button class='btn btn-default' data-role='prev'>« Prev</button><button class='btn btn-default' data-role='next'>Next »</button></div><button class='btn btn-default btn-primary' data-role='end'>End tour</button></nav></div>"});tour.addSteps([{element:"#topbar-right",placement:"bottom",title:"Controls",content:"Use this control bar to change slide and chapter (if present), hide/show videoplayers and thumbnails, get help."},{element:"#camera_vp_container",placement:"right",title:"Camera videoplayer",content:"This is the camera videoplayer where usually the speaker is shown.<br />Click on the <strong>fullscreen</strong> icon on the bottom of the player to enlarge the video."},{element:"#slides_vp_container",placement:"left",title:"Slides videoplayer",content:"This is the slides videoplayer where usually the slides are shown.<br />Click on the <strong>fullscreen</strong> icon on the bottom of the player to enlarge the video."},{element:"#thumbs_scrollbar",placement:"top",title:"Thumnbnails",content:"Here you have the list of thumbnails for this  web lecture.<br />You can click on a thumb to seek the video.<br />Current thumb is bigger than the others."},{element:"#controlbar",placement:"top",title:"Controls",content:"Use this control to <strong>start/pause</strong> the player, to <strong>seek</strong> the video to a specific time and adjust the <strong>volume</strong>."}]),tour.start()},time_controller=function(seek_time){seek_time&&!isNaN(seek_time)&&seek_time>=0&&seek_time!==p.previous_seek_time&&(p.previous_seek_time=seek_time,$("#lbl_current").html(Helpers.format_sec2time(seek_time)),progressbar_controller(seek_time),thumb_controller(seek_time),globals.lecture.chapters.length>0&&chapter_controller(seek_time))},play_controller=function(state){$(globals.jw_videoplayers).each(function(){return"PAUSED"===this.getState()&&state===!1?!0:"PLAYING"!==this.getState()&&"BUFFERING"!==this.getState()||state!==!0?(this.play(state),void 0):!0})},scrollbar_controller=function(){if(p.current_thumb>=0){var new_x=Math.round($("#thumb_"+p.current_thumb).position().left),track_x=Math.round((new_x-p.current_centered)*$("#track").width()/$("#thumbnails").width()),max_x=$("#track").width()-$("#track-thumb").width();new_x>p.current_centered?max_x>track_x?p.$scrollbar.tinyscrollbar_update(new_x-p.current_centered):p.$scrollbar.tinyscrollbar_update("bottom"):p.$scrollbar.tinyscrollbar_update(0)}},progressbar_controller=function(){var new_width=Math.round(100*p.previous_seek_time/globals.lecture.duration);$("#playhead").css("width",new_width+"%").attr("aria-valuenow",new_width)},thumb_controller=function(new_time){var tmp_thumb=0;$(globals.lecture.thumbs).each(function(i){return new_time<this.begin?!1:(tmp_thumb=i,void 0)}),tmp_thumb!==p.current_thumb&&($("#thumb_"+p.current_thumb).removeClass("current"),$("#thumb_"+p.current_thumb).children("img").animate({width:p.thumbs_small.w,height:p.thumbs_small.h,top:p.thumbs_current.h-p.thumbs_small.h},p.thumbs_effect_delay),$("#thumb_"+p.current_thumb).children(".thumb_grayed").width(p.thumbs_current.w).animate({width:0,height:p.thumbs_small.h,top:p.thumbs_current.h-p.thumbs_small.h},p.thumbs_effect_delay),$("#thumb_"+p.current_thumb).children(".thumb_details").animate({top:p.thumbs_current.h-p.thumbs_small.h},p.thumbs_effect_delay),p.current_thumb=tmp_thumb,$("#current_slide").html(p.current_thumb+1),config.debug&&console.log("Thumb changed: ",p.current_thumb),$("#thumb_"+p.current_thumb).addClass("current"),$("#thumb_"+p.current_thumb).children("img").animate({width:p.thumbs_current.w,height:p.thumbs_current.h,top:0},p.thumbs_effect_delay),$("#thumb_"+p.current_thumb).children(".thumb_grayed").animate({height:p.thumbs_current.h,top:0},p.thumbs_effect_delay),$("#thumb_"+p.current_thumb).children(".thumb_details").animate({top:0},p.thumbs_effect_delay),scrollbar_controller());var t=(new_time-globals.lecture.thumbs[p.current_thumb].begin)*p.thumbs_current.w/globals.lecture.thumbs[p.current_thumb].duration;$("#thumb_"+p.current_thumb).children(".thumb_grayed").animate({width:t},p.thumbs_effect_delay),0===p.current_thumb?($("#previous_slide").addClass("disabled"),$("#next_slide").removeClass("disabled")):p.current_thumb===globals.lecture.thumbs.length-1?($("#previous_slide").removeClass("disabled"),$("#next_slide").addClass("disabled")):($("#previous_slide").removeClass("disabled"),$("#next_slide").removeClass("disabled"))},chapter_controller=function(new_time){var tmp_chapter=-1;$(globals.lecture.chapters).each(function(i){return new_time<this.begin?!1:(tmp_chapter=i,void 0)}),tmp_chapter!==p.current_chapter&&(p.current_chapter=tmp_chapter,config.debug&&console.log("Chapter changed: ",p.current_chapter),$("#chaptersbar li").removeClass("active"),$("#chapter_"+p.current_chapter).addClass("active"))},_seek_videoplayers=function(new_time){seeking_start(),globals.jw_camera_vp.seek(new_time),globals.jw_slides_vp.seek(new_time),play_controller(!0)},seeking_start=function(){$("#progressbar").addClass("progress-striped active"),$("#playhead").html("Seeking...")},seeking_stop=function(){$("#progressbar").removeClass("progress-striped active"),$("#playhead").html("")},volume_slider_show=function(){"unmuted"!==$("#btn_volume").data("current")||$("#volume-slider").is(":visible")||$("#volume-slider").css("top",$("#btn_volume").offset().top-$("#volume-slider").height()-16).css("left",$("#btn_volume").offset().left+2).fadeIn("fast")},volume_slider_hide=function(){$("#volume-slider").is(":visible")&&setTimeout(function(){p.cursor_vol_btn||p.cursor_vol_slider||$("#volume-slider").fadeOut("fast")},1e3)},onTime=function(event){seeking_stop();var new_time=parseInt(event.position,10);config.debug&&console.debug("Time event: ",new_time),time_controller(new_time)},onResize=function(){if(config.debug&&console.log("Resize event"),$(window).width()>0&&$(window).height()>0){var ts_height=$("#thumbs_scrollbar").is(":visible")?$("#thumbs_scrollbar").height():0,vp_height=$(window).height()-$("#topbar").height()-ts_height-$("#controlbar").height();$("#videoplayers").height(vp_height);var controls_width=$("#topbar").width()-$("#logo").width()-$("#topbar-right").width()-30;$("#title").css("max-width",controls_width),$("#speakers").css("max-width",controls_width-$("#when").width()),$("#thumbnails").width()<$(window).width()?$("#scrollbar").hide():$("#thumbs_scrollbar").is(":visible")&&($("#scrollbar").show(),p.$scrollbar.tinyscrollbar_update("relative"),p.current_centered=Math.round($("#scrollbar").width()/2-p.thumbs_current.w/2),scrollbar_controller()),$("#progressbar_container").width($("#controlbar").width()-p.controlbar_btns_width),Resize.handler($(window).width(),vp_height)}},btn_thumb_onClick=function(id){config.debug&&console.log("BTN click: thumb"),config.debug&&console.log("Go to thumb: ",id,globals.lecture.thumbs[id].begin),_seek_videoplayers(globals.lecture.thumbs[id].begin)},btn_next_thumb_onClick=function(){config.debug&&console.log("BTN click: next thumb"),p.current_thumb+1<globals.lecture.thumbs.length&&(config.debug&&console.log("Go to thumb: ",p.current_thumb+1,globals.lecture.thumbs[p.current_thumb+1].begin),_seek_videoplayers(globals.lecture.thumbs[p.current_thumb+1].begin))},btn_prev_thumb_onClick=function(){config.debug&&console.log("BTN click: previous thumb"),p.current_thumb-1>=0&&(config.debug&&console.log("Go to thumb: ",p.current_thumb-1,globals.lecture.thumbs[p.current_thumb-1].begin),_seek_videoplayers(globals.lecture.thumbs[p.current_thumb-1].begin))},btn_chapter_onClick=function(id){config.debug&&console.log("Chapter changed"),config.debug&&console.log("Go to chapter: ",id,globals.lecture.chapters[id].begin),p.current_chapter!==id&&_seek_videoplayers(globals.lecture.chapters[id].begin)},toggle_videos=function(sel){"0"===sel?globals.slides_vp_visible&&("html5"==globals.player_mode&&($("#slides_vp_jwplayer_logo").width(0).height(0),$("#slides_vp_jwplayer_controlbar").width(0).height(0)),globals.slides_vp_visible=!1,globals.camera_vp_visible=!0,$(window).trigger("resize"),$("#camera_only").parent().removeClass("btn-default").addClass("btn-primary"),$("#slides_only").parent().removeClass("btn-primary").addClass("btn-default"),$("#both_videos").parent().removeClass("btn-primary").addClass("btn-default")):"1"===sel?globals.camera_vp_visible&&("html5"==globals.player_mode&&($("#camera_vp_jwplayer_logo").width(0).height(0),$("#camera_vp_jwplayer_controlbar").width(0).height(0)),globals.camera_vp_visible=!1,globals.slides_vp_visible=!0,$(window).trigger("resize"),$("#slides_only").parent().removeClass("btn-default").addClass("btn-primary"),$("#camera_only").parent().removeClass("btn-primary").addClass("btn-default"),$("#both_videos").parent().removeClass("btn-primary").addClass("btn-default")):"2"===sel&&(globals.camera_vp_visible=!0,globals.slides_vp_visible=!0,$(window).trigger("resize"),$("#both_videos").parent().removeClass("btn-default").addClass("btn-primary"),$("#camera_only").parent().removeClass("btn-primary").addClass("btn-default"),$("#slides_only").parent().removeClass("btn-primary").addClass("btn-default"))},btn_toggle_thumbs_onClick=function(){config.debug&&console.log("BTN click: toggle thumbs"),$("#thumbs_scrollbar").is(":visible")?($("#thumbs_scrollbar").hide(),$(window).trigger("resize"),$("#toggle_thumbs").removeClass("btn-primary").addClass("btn-default"),$("#toggle_thumbs").tooltip("hide").attr("data-original-title","Show thumbnails").tooltip("fixTitle")):($("#thumbs_scrollbar").show(),$(window).trigger("resize"),$("#toggle_thumbs").removeClass("btn-default").addClass("btn-primary"),$("#toggle_thumbs").tooltip("hide").attr("data-original-title","Hide thumbnails").tooltip("fixTitle"))},init=function(){try{var xml_call=$.ajax({url:config.lecture_file.filepath,error:function(xhr,ajaxconfig,thrownError){console.error("Error: "+xhr.status+" "+thrownError),$(".loading_modal").css("background","#333"),$("#loading_content").css("width","60%").css("left","20%").html('<strong>Error loading the player for this lecture.</strong><br />Please contact the support by email at <a href="mailto:'+config.support_email+'">'+config.support_email+"</a>")}});$.when(xml_call).done(function(data){$("#container").show(),LectureParser.parse(data),document.title=globals.lecture.title,$("#camera_vp_source").attr("src",config.full_url+"camera.mp4"),$("#slides_vp_source").attr("src",config.full_url+"slides.mp4"),globals.jw_camera_vp=jwplayer("camera_vp").setup({skin:"videoplayer/jwplayer-5.10/skin/nacht_fullscreen_only/nacht_fullscreen_only.xml",volume:80,width:640,height:360,timeinterval:1e3,screencolor:"000000",modes:[{type:"html5"},{type:"flash",src:"videoplayer/jwplayer-5.10/player.swf",config:{provider:config.provider,streamer:config.streamer,file:config.relative_path+config.camera_file}}]}).onReady(function(){globals.camera_vp_ready=!0,globals.camera_vp_ar=this.getWidth()/this.getHeight(),$("body").trigger("jw_camera_vp.ready")}),globals.jw_slides_vp=jwplayer("slides_vp").setup({skin:"videoplayer/jwplayer-5.10/skin/nacht_fullscreen_only/nacht_fullscreen_only.xml",mute:!0,width:1024,height:768,timeinterval:1e3,screencolor:"000000",modes:[{type:"html5"},{type:"flash",src:"videoplayer/jwplayer-5.10/player.swf",config:{provider:config.provider,streamer:config.streamer,file:config.relative_path+config.slides_file}}]}).onReady(function(){globals.slides_vp_ready=!0,globals.slides_vp_ar=this.getWidth()/this.getHeight(),$("body").trigger("jw_slides_vp.ready")}),globals.jw_videoplayers.push(globals.jw_camera_vp),globals.jw_videoplayers.push(globals.jw_slides_vp),$("body").on("jw_camera_vp.ready jw_slides_vp.ready",function(){if(globals.camera_vp_ready&&globals.slides_vp_ready){globals.player_mode=globals.jw_camera_vp.getRenderingMode(),init_topbar(),init_videoplayers(),init_thumbnails(),init_controlbar(),Videoplayers_KeepInSync.init(globals.jw_camera_vp,globals.jw_slides_vp,!0),$(window).resize($.debounce(200,onResize)),$(window).trigger("resize"),$("#volume-slider").hide(),$("body").removeClass("loading"),init_tour();
var slide=Helpers.param_by_name("slide"),chapter=Helpers.param_by_name("chapter"),time=Helpers.param_by_name("time"),ftime=Helpers.param_by_name("ftime");slide?(slide=parseInt(slide,10)-1,slide>=0&&slide<=globals.lecture.thumbs.length&&_seek_videoplayers(globals.lecture.thumbs[slide].begin)):chapter?(chapter=parseInt(chapter,10)-1,chapter>=0&&chapter<=globals.lecture.chapters.length&&_seek_videoplayers(globals.lecture.chapters[chapter].begin)):time?(time=parseInt(time,10),time>0&&time<globals.lecture.duration&&_seek_videoplayers(time)):ftime&&(time=Helpers.format_time2sec(ftime),time>0&&time<globals.lecture.duration&&_seek_videoplayers(time))}})})}catch(err){console.error(err)}},{init:init}}();